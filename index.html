<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="ngx_mruby : ngx_murby is A Fast and Memory-Efficient Web Server Extension Mechanism Using Scripting Language mruby for nginx" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>ngx_mruby</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/matsumoto-r/ngx_mruby">View on GitHub</a>

          <h1 id="project_title">ngx_mruby</h1>
          <h2 id="project_tagline">ngx_murby is A Fast and Memory-Efficient Web Server Extension Mechanism Using Scripting Language mruby for nginx</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/matsumoto-r/ngx_mruby/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/matsumoto-r/ngx_mruby/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a name="whats-ngx_mruby" class="anchor" href="#whats-ngx_mruby"><span class="octicon octicon-link"></span></a>What's ngx_mruby</h2>

<p><strong>ngx_murby is A Fast and Memory-Efficient Web Server Extension Mechanism Using Scripting Language mruby for nginx.</strong></p>

<ul>
<li>ngx_mruby is to provide an alternative to <a href="http://matsumoto-r.github.io/mod_mruby/">mod_mruby of Apache httpd</a> or lua-nginx-module. </li>
<li>You can implemet nginx modules by Ruby scripts on nginx!</li>
<li>Supported nginx <strong>1.2/1.3/1.4/1.5.*</strong>
</li>
</ul><div class="highlight highlight-ruby"><pre><span class="c1"># location /proxy {</span>
<span class="c1">#   mruby_set $backend "/path/to/proxy.rb";</span>
<span class="c1">#   proxy_pass   http://$backend;</span>
<span class="c1"># }</span>

<span class="n">backends</span> <span class="o">=</span> <span class="o">[</span>
  <span class="s2">"test1"</span><span class="p">,</span>
  <span class="s2">"test2"</span><span class="p">,</span>
  <span class="s2">"test3"</span><span class="p">,</span>
<span class="o">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="no">Redis</span><span class="o">.</span><span class="n">new</span> <span class="s2">"192.168.12.251"</span><span class="p">,</span> <span class="mi">6379</span>
<span class="n">r</span><span class="o">.</span><span class="n">get</span> <span class="n">backends</span><span class="o">[</span><span class="nb">rand</span><span class="p">(</span><span class="n">backends</span><span class="o">.</span><span class="n">length</span><span class="p">)</span><span class="o">]</span>
</pre></div>

<ul>
<li>see <a href="https://github.com/matsumoto-r/ngx_mruby/blob/master/example/nginx.conf">examples</a>
</li>
</ul><h2>
<a name="abstract" class="anchor" href="#abstract"><span class="octicon octicon-link"></span></a>Abstract</h2>

<p>As the increase of large-scale and complex Web services, not only a development of Web applications but also an implementation of Web server extensions is required in many cases. The Web server extensions were mainly implemented in C language because of fast and memory-efficient behavior, but extension methods using scripting language are proposed with consideration of maintainability and productivity. However, if the existing methods primarily intended to enhance not the implementation of Web applications but the implementation of internal processing of the Web server, the problem remains in terms of fast, memory-efficiency and safety. Therefore, we propose a fast and memory-efficient Web server extension mechanism using scripting language. We design the architecture that a server process create the region to save the state of the interpreter at the server process startup, and multiple scripts share the region in order to process fast when the script is called as internal processing from a Web server process. The server process free the global variables table, the exception flag and the byte-code which cause the increase of memory usage mainly, in order to reduce the memory usage and extend safely by preventing interference between each scripts because of sharing the region. We implement the mechanism that can extend the internal processing of nginx easily by Ruby scripts using nginx and embeddable scripting language mruby. It's called "ngx_mruby".</p>

<h2>
<a name="how-to-use" class="anchor" href="#how-to-use"><span class="octicon octicon-link"></span></a>How to use</h2>

<h3>
<a name="1-download" class="anchor" href="#1-download"><span class="octicon octicon-link"></span></a>1. Download</h3>

<pre><code>git clone git://github.com/matsumoto-r/ngx_mruby.git
cd ngx_mruby
git submodule init
git submodule update
</code></pre>

<h3>
<a name="2-build" class="anchor" href="#2-build"><span class="octicon octicon-link"></span></a>2. Build</h3>

<ul>
<li>
<p>configure example</p>

<pre><code>./configure --with-ngx-src-root=${NGINX_SRC} --with-ngx-config-opt="--prefix=/usr/local/nginx"
</code></pre>
</li>
<li>
<p>mruby build</p>

<pre><code>make build_mruby
</code></pre>
</li>
<li>
<p>ngx_mruby build</p>

<pre><code>make 
</code></pre>

<p>or  </p>

<pre><code>cd ${NGINX_SRC}
./configure --prefix=/usr/local/nginx --add-module=${NGX_MRUBY_SRC} --add-module=${SOME_MODULE}
make
</code></pre>
</li>
</ul><h3>
<a name="3-install" class="anchor" href="#3-install"><span class="octicon octicon-link"></span></a>3. Install</h3>

<pre><code>sudo make install
</code></pre>

<h3>
<a name="4-add-setting" class="anchor" href="#4-add-setting"><span class="octicon octicon-link"></span></a>4. Add setting</h3>

<pre><code>location /mruby {
    mruby_content_handler /usr/local/nginx122/html/hello.rb;
}
</code></pre>

<h3>
<a name="5-create-mruby-script-usrlocalnginxhtmlhellorb" class="anchor" href="#5-create-mruby-script-usrlocalnginxhtmlhellorb"><span class="octicon octicon-link"></span></a>5. Create mruby script /usr/local/nginx/html/hello.rb</h3>

<pre><code>Nginx.rputs(Time.now.to_s + "hello mruby world for nginx.")
</code></pre>

<h3>
<a name="6-start-nginx" class="anchor" href="#6-start-nginx"><span class="octicon octicon-link"></span></a>6. Start nginx</h3>

<pre><code>/usr/local/nginx/sbin/nginx
</code></pre>

<h3>
<a name="7-access-httpexamplecommruby-sedexamplecommydomain" class="anchor" href="#7-access-httpexamplecommruby-sedexamplecommydomain"><span class="octicon octicon-link"></span></a>7. Access <a href="http://example.com/mruby">http://example.com/mruby</a> (sed/example.com/mydomain/)</h3>

<pre><code>Sat Jul 28 18:05:51 2012 hello mruby world for nginx.
</code></pre>

<p>Display above. Welcome mruby world for nginx!!</p>

<h1>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h1>

<p>under the MIT License:</p>

<ul>
<li><a href="http://www.opensource.org/licenses/mit-license.php">http://www.opensource.org/licenses/mit-license.php</a></li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">ngx_mruby maintained by <a href="https://github.com/matsumoto-r">matsumoto-r</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
